---
// src/components/TwikooComments.astro
const { path, elId = 'twikoo-comments' } = Astro.props;
---

<div id={elId}></div>

<script is:inline>
  (function() {
    if (typeof window === 'undefined') return;

    const initTwikoo = () => {
      const container = document.getElementById({elId});
      if (!container) {
        setTimeout(initTwikoo, 300);
        return;
      }

      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/twikoo@1.6.22/dist/twikoo.all.min.js';
      script.onload = () => {
        if (typeof twikoo !== 'undefined') {
          twikoo.init({
            url: 'https://twikoo-api-gmgc.vercel.app',
            el: '#${elId}',
            path: '${path}',
            lang: 'zh-CN'
          }).catch(console.error);
        }
      };
      document.head.appendChild(script);
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTwikoo);
    } else {
      initTwikoo();
    }
  })();
</script>
