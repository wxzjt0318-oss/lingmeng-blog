<script is:inline>
  // 确保只在客户端执行
  if (typeof window !== 'undefined') {
    const initTwikoo = () => {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/twikoo@latest/dist/twikoo.min.js';
      script.onload = () => {
        if (typeof twikoo !== 'undefined') {
          twikoo.init({
            url: 'https://twikoo-api-gmgc.vercel.app',
            el: '#twikoo-visitorbook',
            path: '/visitorbook',
            lang: 'zh-CN',
            commentCount: true,
            inputPlaceholder: '说点什么吧～',
            emoji: [
              'https://cdn.jsdelivr.net/gh/IKnowYou233/twikoo-emoji@main/emoji.json',
              'https://cdn.jsdelivr.net/gh/IKnowYou233/twikoo-emoji@main/emoji-akashi.json'
            ],
            dark: document.documentElement.classList.contains('dark')
          }).catch(err => {
            console.error('Twikoo init failed:', err);
          });
        }
      };
      script.onerror = () => {
        console.error('Failed to load Twikoo script');
      };
      document.head.appendChild(script);
    };

    // 如果 Astro 已加载，立即初始化；否则等 DOM 加载完
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTwikoo);
    } else {
      initTwikoo();
    }
  }
</script>
